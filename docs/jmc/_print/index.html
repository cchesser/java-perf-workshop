<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.79.1" /><link rel="canonical" type="text/html" href="https://jvmperf.net/docs/jmc/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Java Mission Control &amp; Flight Recorder | jvmperf: Java Performance Workshop</title><meta property="og:title" content="Java Mission Control &amp; Flight Recorder" />
<meta property="og:description" content="Initial look at the JVM from its native perspective.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://jvmperf.net/docs/jmc/" />
<meta property="og:site_name" content="jvmperf: Java Performance Workshop" />
<meta itemprop="name" content="Java Mission Control &amp; Flight Recorder">
<meta itemprop="description" content="Initial look at the JVM from its native perspective.
">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java Mission Control &amp; Flight Recorder"/>
<meta name="twitter:description" content="Initial look at the JVM from its native perspective.
"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-187218497-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<link rel="preload" href="/scss/main.min.d365b133824fa7cc9e634c8a9ba97597f3759b03ad3fd78d42c3d136099b4543.css" as="style">
<link href="/scss/main.min.d365b133824fa7cc9e634c8a9ba97597f3759b03ad3fd78d42c3d136099b4543.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="/css/prism.css"/>



  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="font-weight-bold"><i class="fas fa-cube"></i>&nbsp;&nbsp;jvmperf</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/docs/" ><span class="active">Workshop</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a  class="nav-link" href="https://github.com/cchesser/java-perf-workshop/" target="_blank" ><span>GitHub</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link" href="/contributors/" ><span>Contributors</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site‚Ä¶"
  aria-label="Search this site‚Ä¶"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.e58fa4f6e97cd76ff2ec335879c50632.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/jmc/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Java Mission Control &amp; Flight Recorder</h1>
<div class="lead">Initial look at the JVM from its native perspective.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-796d3fdeba0d8745c34e520dae3a52c6">Introduction</a></li>


    
  
    
    
	
<li>2: <a href="#pg-a19b61c681cd81aa3a52b7ab7f00e40a">Method Profiling</a></li>


    
  
    
    
	
<li>3: <a href="#pg-8e7ed7a50881f742b2d8880c7a90c384">Exceptions</a></li>


    
  
    
    
	
<li>4: <a href="#pg-140f7f618c6427a75628497db237e231">Threads</a></li>


    
  
    
    
	
<li>5: <a href="#pg-7fa58ef1806796b7bc181181489c25b1">Memory</a></li>


    
  
    
    
	
<li>6: <a href="#pg-677c02967c93d2d024e0683d7ffa6d55">I/O Operations</a></li>


    
  
    
    
	
<li>7: <a href="#pg-e82c7a3c3eba03724a0e8df5a3ff19a3">References</a></li>


    
  

    </ul>


<div class="content">
      <p>In this workshop, we will be getting more familiar with using Java Mission Control and the Flight Recorder. As we have been running our service, we want to gather more insight of the code in the service by running series of simple tests and measuring the service.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-796d3fdeba0d8745c34e520dae3a52c6">1 - Introduction</h1>
    <div class="lead">Introduction into Java Mission Control with Flight Recorder</div>
	<h2 id="java-flight-recorder">Java Flight Recorder</h2>
<p>The Java Flight Recorder (JFR) is a very low overhead profiling and diagnostics tool. It was inherited from the JRockit JVM, and originally was offered as part of the HotSpot JVM. It is designed to be &ldquo;black box&rdquo; data recorder of the the run-time, which can be used in production environments, making it an attractive tool for profiling code since it has low overhead on the JVM.</p>
<p>Newer versions of JMC are developed as part of the OpenJDK Mission Control project.</p>
<p>To enable the Flight Recorder on the JVM, the following options need to be included on the JVM:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-XX:+UnlockCommercialFeatures -XX:+FlightRecorder
</code></pre></div><p>‚ùó Notice that you have to include <code>-XX:+UnlockCommercialFeatures</code> first in the options listing. This is because using Flight Recorder is a feature that requires additional licensing when used in production environments. One of the following licenses is required in order to utilize this in a production environment.</p>
<ul>
<li>Oracle Java SE Advanced</li>
<li>Oracle Java SE Suite</li>
</ul>
<p>However, you may use this in non-production environments without additional licensing.</p>
<h3 id="higher-fidelity-on-method-profiling">Higher Fidelity on Method Profiling</h3>
<p>To get better fidelity on method profiling, include the following options which will enable the compiler to include additional metadata on non-safe code points. This is helpful, as sometimes the metadata will not fully resolve to the correct line in the code.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-XX:+UnlockDiagnosticVMOptions -XX:+DebugNonSafepoints
</code></pre></div><h2 id="java-mission-control">Java Mission Control</h2>
<p>We will be using Java Mission Control to monitor and evaluate the Java flight recordings. To start up  Java Mission Control, simply executing the following in your console:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jmc
</code></pre></div><p>üí° In order to be able to invoke <code>jmc</code> (Java Mission Control) from your console, it assumes <code>$JAVA_HOME/bin</code> is on your <code>$PATH</code>. If it is not included, go ahead and update your profile to include this so you can easily invoke <code>jmc</code> from your terminal.</p>
<h2 id="start-service-with-jfr">Start Service with JFR</h2>
<p>Let&rsquo;s start profiling our service. Start the service up by enabling JFR:</p>
<h3 id="start-from-the-console">Start from the console</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Note, if you are running this server from a different folder, consider changing the SERVER_HOME</span>
<span style="color:#000">SERVER_HOME</span><span style="color:#ce5c00;font-weight:bold">=</span>java-perf-workshop-server/target
java -XX:+UnlockCommercialFeatures -XX:+FlightRecorder -XX:+UnlockDiagnosticVMOptions -XX:+DebugNonSafepoints -jar <span style="color:#000">$SERVER_HOME</span>/java-perf-workshop-server-1.1.0-SNAPSHOT.jar server server.yml
</code></pre></div><p>üí° Starting with Java Mission Control 5.5 <em>(included in Oracle Java 8u40)</em>, you no longer have to enable JFR prior to capturing the recording (it will dynamically enable it, after prompting about it).</p>
<p><img src="/jmc/unlock_commercial_features_dialog.png" alt=""></p>
<h2 id="start-flight-recording-from-jmc">Start Flight Recording from JMC</h2>
<p><img src="/jmc/start_flight_recording.png" alt="jmc_start"></p>
<p>This will open a window where you apply some settings for the recording. First select that you want this to be a <strong>Continuous recording</strong> and for Event settings, we will import a template to get some consistent settings for profiling. Within the <strong>Template Manager</strong>, select <strong>Import Files&hellip;</strong> and import the <code>open_jdk_9_.jfc</code> included in the <a href="https://github.com/cchesser/java-perf-workshop/tree/main/docs/content/docs/jmc">content/docs/jmc</a> folder. It should appear as <em>Java Performance Workshop JDK9+ Profile</em>. Select this as the <strong>Event Settings</strong> and then click on <strong>Finish</strong>.</p>
<p>For reference, these are the options for the template.</p>
<p><img src="/jmc/profile_settings.png" alt=""></p>
<p>First select that you want this to be a <strong>Continuous recording</strong> and for Event settings we will use <strong>Profiling on Server</strong>.</p>
<p><img src="/jmc/start_recording_wizard.png" alt=""></p>
<p>Once your flight recording is being captured in a <em>Continuous</em> recording, it will show a ‚àû.</p>
<p><img src="https://github.com/cchesser/java-perf-workshop/wiki/images/jmc_flight_recorder_started.png" alt="jmc_started"></p>
<p>üí° You can see the JFR templates (continuous / profile) which are shipped as part of the JRE in: <code>$JAVA_HOME/jre/lib/jfr</code>. These become helpful if you are wanting to compare your settings to some of the standard ones.</p>
<h2 id="generate-http-traffic-on-service">Generate HTTP traffic on service</h2>
<p>We will want to generate some traffic on the service to measure some general characteristics of the service:</p>
<ul>
<li>Throughput (requests per second)</li>
<li>Response time</li>
<li>Trend of response time over time</li>
</ul>
<p><img src="/diagrams/web_traffic.png" alt=""></p>
<p>By generating traffic on service, this gives us baseline activity in the JVM to start evaluating the flight recording.</p>
<h3 id="basic-test">Basic test</h3>
<p>This service under test, is a simple web service which provides results based on a search API. When interacting with the service, you can simply supply a HTTP GET on the <em>search</em> resource with a query parameter (&lsquo;q&rsquo;) with the term that you are searching for. It will then return KCDC&rsquo;s 2015 sessions that contain that term. Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl <span style="color:#4e9a06">&#34;http://localhost:8080/search?q=jvm&#34;</span>
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;results&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span> <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;title&#34;</span> : <span style="color:#4e9a06">&#34;Concurrency Options on the JVM&#34;</span>,
    <span style="color:#4e9a06">&#34;presenter&#34;</span> : <span style="color:#4e9a06">&#34;Jessica Kerr&#34;</span>,
    <span style="color:#4e9a06">&#34;sessionType&#34;</span> : <span style="color:#4e9a06">&#34;Regular Session&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">}</span>, <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;title&#34;</span> : <span style="color:#4e9a06">&#34;Exploring the Actor Model with Akka.NET&#34;</span>,
    <span style="color:#4e9a06">&#34;presenter&#34;</span> : <span style="color:#4e9a06">&#34;Robert Macdonald Smith&#34;</span>,
    <span style="color:#4e9a06">&#34;sessionType&#34;</span> : <span style="color:#4e9a06">&#34;Regular Session&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">}</span>, <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;title&#34;</span> : <span style="color:#4e9a06">&#34;What&#39;s in your JVM?&#34;</span>,
    <span style="color:#4e9a06">&#34;presenter&#34;</span> : <span style="color:#4e9a06">&#34;Carl Chesser&#34;</span>,
    <span style="color:#4e9a06">&#34;sessionType&#34;</span> : <span style="color:#4e9a06">&#34;4-Hour Workshop&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><h3 id="using-apache-benchmark">Using Apache Benchmark</h3>
<p>We can utilize <a href="http://httpd.apache.org/docs/2.2/programs/ab.html">Apache Benchmark</a> to generate traffic on the service From the console, we will execute the following to generate traffic against our service. Note, we will use a very basic search of just &ldquo;a&rdquo;, since this will generate more results.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ab -n <span style="color:#0000cf;font-weight:bold">1000</span> -c <span style="color:#0000cf;font-weight:bold">15</span> <span style="color:#4e9a06">&#34;http://localhost:8080/search?q=a&#34;</span>
</code></pre></div><h3 id="using-loadtest">Using loadtest</h3>
<p>An alternative to Apache Benchmark, is <a href="https://github.com/alexfernandez/loadtest">loadtest</a> (a node.js equivalent). To install:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo npm install -g loadtest
</code></pre></div><p>Then you can execute similarly:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">loadtest -n <span style="color:#0000cf;font-weight:bold">1000</span> -c <span style="color:#0000cf;font-weight:bold">15</span> <span style="color:#4e9a06">&#34;http://localhost:8080/search?q=a&#34;</span>
</code></pre></div><h3 id="using-gatling">Using gatling</h3>
<p>Alternatively, you can use <a href="https://gatling.io/">gatling</a> (a performance library with a scala dsl ).</p>
<p>This should launch the <code>WorkshopSimulation</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> mvn -f java-perf-workshop-tester/ gatling:test
</code></pre></div><p>Sample output while running:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>~/java-perf-workshop/java-perf-workshop-tester<span style="color:#ce5c00;font-weight:bold">]</span>$ mvn gatling:test
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Scanning <span style="color:#204a87;font-weight:bold">for</span> projects...
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> ------------------------------------------------------------------------
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Building java-perf-workshop-tester 1.1.0-SNAPSHOT
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> ------------------------------------------------------------------------
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> --- gatling-maven-plugin:2.2.4:test <span style="color:#ce5c00;font-weight:bold">(</span>default-cli<span style="color:#ce5c00;font-weight:bold">)</span> @ java-perf-workshop-tester ---
19:12:16,662 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.LoggerContext<span style="color:#ce5c00;font-weight:bold">[</span>default<span style="color:#ce5c00;font-weight:bold">]</span> - Could NOT find resource <span style="color:#ce5c00;font-weight:bold">[</span>logback-test.xml<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,663 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.LoggerContext<span style="color:#ce5c00;font-weight:bold">[</span>default<span style="color:#ce5c00;font-weight:bold">]</span> - Could NOT find resource <span style="color:#ce5c00;font-weight:bold">[</span>logback.groovy<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,663 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.LoggerContext<span style="color:#ce5c00;font-weight:bold">[</span>default<span style="color:#ce5c00;font-weight:bold">]</span> - Found resource <span style="color:#ce5c00;font-weight:bold">[</span>logback.xml<span style="color:#ce5c00;font-weight:bold">]</span> at <span style="color:#ce5c00;font-weight:bold">[</span>file:/J:/Workspaces/java-perf-workshop/java-perf-workshop-tester/target/test-classes/logback.xml<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,663 <span style="color:#000;font-weight:bold">|</span>-WARN in ch.qos.logback.classic.LoggerContext<span style="color:#ce5c00;font-weight:bold">[</span>default<span style="color:#ce5c00;font-weight:bold">]</span> - Resource <span style="color:#ce5c00;font-weight:bold">[</span>logback.xml<span style="color:#ce5c00;font-weight:bold">]</span> occurs multiple <span style="color:#204a87">times</span> on the classpath.
19:12:16,663 <span style="color:#000;font-weight:bold">|</span>-WARN in ch.qos.logback.classic.LoggerContext<span style="color:#ce5c00;font-weight:bold">[</span>default<span style="color:#ce5c00;font-weight:bold">]</span> - Resource <span style="color:#ce5c00;font-weight:bold">[</span>logback.xml<span style="color:#ce5c00;font-weight:bold">]</span> occurs at <span style="color:#ce5c00;font-weight:bold">[</span>file:/J:/Workspaces/java-perf-workshop/java-perf-workshop-tester/target/test-classes/logback.xml<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,663 <span style="color:#000;font-weight:bold">|</span>-WARN in ch.qos.logback.classic.LoggerContext<span style="color:#ce5c00;font-weight:bold">[</span>default<span style="color:#ce5c00;font-weight:bold">]</span> - Resource <span style="color:#ce5c00;font-weight:bold">[</span>logback.xml<span style="color:#ce5c00;font-weight:bold">]</span> occurs at <span style="color:#ce5c00;font-weight:bold">[</span>jar:file:/C:/Users/JMonterrubio/.m2/repository/io/gatling/gatling-maven-plugin/2.2.4/gatling-maven-plugin-2.2.4.jar!/logback.xml<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,727 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - debug attribute not <span style="color:#204a87">set</span>
19:12:16,731 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.core.joran.action.AppenderAction - About to instantiate appender of <span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">[</span>ch.qos.logback.core.ConsoleAppender<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,737 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.core.joran.action.AppenderAction - Naming appender as <span style="color:#ce5c00;font-weight:bold">[</span>CONSOLE<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,742 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.core.joran.action.NestedComplexPropertyIA - Assuming default <span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">[</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">[</span>encoder<span style="color:#ce5c00;font-weight:bold">]</span> property
19:12:16,781 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.joran.action.RootLoggerAction - Setting level of ROOT logger to WARN
19:12:16,782 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.core.joran.action.AppenderRefAction - Attaching appender named <span style="color:#ce5c00;font-weight:bold">[</span>CONSOLE<span style="color:#ce5c00;font-weight:bold">]</span> to Logger<span style="color:#ce5c00;font-weight:bold">[</span>ROOT<span style="color:#ce5c00;font-weight:bold">]</span>
19:12:16,782 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - End of configuration.
19:12:16,783 <span style="color:#000;font-weight:bold">|</span>-INFO in ch.qos.logback.classic.joran.JoranConfigurator@7a0ac6e3 - Registering current configuration as safe fallback point

Simulation cchesser.javaperf.workshop.WorkshopSimulation started...
</code></pre></div><h2 id="stop-flight-recorder">Stop Flight Recorder</h2>
<p>After you have played traffic through the service, you can then stop your flight recording from JMC.</p>
<p><img src="https://github.com/cchesser/java-perf-workshop/wiki/images/jmc_flight_recorder_stop.png" alt="jmc_stop"></p>
<p>Then dump the whole recording.</p>
<p><img src="https://github.com/cchesser/java-perf-workshop/wiki/images/jmc_flight_recorder_dump.png" alt="jmc_dump"></p>
<h2 id="the-flight-recording">The Flight Recording</h2>
<p>From a Java Flight Recording, there are several categories of information (pages) you can view from JMC:</p>
<ul>
<li>Code Information:
<ul>
<li><strong>Method Profiling</strong>: Provides information about specific method runs and how long each run took, identifying <em>hot spots</em> in your code base.</li>
<li><strong>Exceptions</strong>: Displays Exceptions and Errors thrown and which methods threw them. Viewing exceptions requires editing the settings to also capture Exceptions.</li>
</ul>
</li>
<li>Thread information:
<ul>
<li><strong>Threads</strong>: Provides a snapshot of all the threads that belong to the Java Application and the thread activity.</li>
<li><strong>Lock Instances</strong>: Provides further details on threads by specifying lock information, showing which threads request and which threads take a particular lock.</li>
<li><strong>Thread Dump</strong>: Provides period thread dump information.</li>
</ul>
</li>
<li>Memory Information:
<ul>
<li><strong>Memory</strong>: Represents heap memory usage of the JVM.</li>
</ul>
</li>
<li>IO Information:
<ul>
<li><strong>File I/O</strong>: Displays File costs and behaviors</li>
<li><strong>Socket I/O</strong>: Displays Network costs and behaviors</li>
</ul>
</li>
<li>JVM Internals:
<ul>
<li><strong>Garbage Collections</strong>: Displays heap usage compared to pause times as well as GC events.</li>
<li><strong>Compliations</strong>: Provides details on code compilation.</li>
<li><strong>TLAB Allocations</strong>: Displays Thread Local Allocation Buffers.</li>
</ul>
</li>
<li>System Information:
<ul>
<li><strong>Processes</strong>: See other processes on the system and what is competing for resources.</li>
<li><strong>Environment</strong>: Provides information about the environment in which the recording was made.</li>
<li><strong>System Properties</strong>: Show properties passed on to the JVM.</li>
</ul>
</li>
<li>Events:
<strong>Event Browser</strong>: View detailed log of the events within the JVM. You can use this page to further filter down on events across all the pages in the recording.</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Feel free to reference the additional <a href="/docs/jmc/resources">resources</a> as you navigate through the sections.

</div>

  <br/>
  <div class="card mb-3" style="width: 80%;">
      <div class="card-header text-white border-info bg-info">
          <i class="fas fa-arrow-alt-circle-right"></i>&nbsp;&nbsp;Up Next</div>
      <div class="card-body">
        <p class="card-text">
In the next section, we'll find out more about what our methods are doing.
</p>
        <a href="https://jvmperf.net/docs/jmc/method_profiling/">Method Profiling</a></i>
      </div>
  </div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a19b61c681cd81aa3a52b7ab7f00e40a">2 - Method Profiling</h1>
    <div class="lead">Gather context of where we spend time in our code</div>
	<p>Our first look at the recording will start with finding out where we might be spending time with our code.</p>
<h3 id="method-profiling-page">Method Profiling Page</h3>
<p>We&rsquo;ll start by taking a look at the detailed <strong>Method Profiling Page</strong>. This page displays how often a specific method is ran based on sampling.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    This page is a little bit difficult to use in JMC7, planned improvements for the data visualization will come in JMC8, see <a href="https://github.com/openjdk/jmc/pull/165">JMC#165</a>

</div>

<p><img src="/jmc/method_profile_page.png" alt=""></p>
<p>By default, this view groups threads by method, but you can also include the line number for each method. This can be accomplishbed by selecting the <strong>View Menu</strong> option and  going to <strong>Distinguish Frames By</strong> and selecting <strong>Line Number</strong>.</p>
<p><img src="/jmc/method_profile_distinguish_line_numbers.png" alt=""></p>
<p>üí° Generally, you don&rsquo;t need this, as it can be quite apparent by the base method being invoked where the cost is at. Though, it may be helpful to include in some contexts.</p>
<p><img src="/jmc/method_profile_with_line_numbers.png" alt=""></p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Remember that this is just a sampling view, and does not mean that only a small amount of methods were hit. We&rsquo;ll be able to visualize more of this info in the following part.

</div>

<h2 id="java-application">Java Application</h2>
<p>Navigate to the <strong>Java Application</strong> page. This page provides an overview of the state of the JVM and collates information from a couple of the dedicated pages.</p>
<p><img src="/jmc/java_application_page.png" alt=""></p>
<p>Using the checkboxes on the right of the Graph, select only <strong>Method Profiling</strong> to narrow down the set of events on the graph:</p>
<p><img src="/jmc/java_application_method_profiling.png" alt=""></p>
<p>The <strong>Stack Trace</strong> view from this page can give you a better count of sampled methods (not just the ones from a specific Method Profiling event)</p>
<p><img src="/jmc/java_application_stack_trace.png" alt=""></p>
<p>This information is the equivalent of the <strong>Hot Methods</strong> tab in JMC 5, see <a href="https://community.oracle.com/tech/developers/discussion/4094447/difference-between-method-profiling-and-java-application-stack-traces">forum discussion</a>.</p>
<p>We can then use this information to correlate what is happening in our code:</p>
<p><img src="/jmc/hot_method_line_number.png" alt=""></p>
<h2 id="i-classfas-fa-compassi-explore"><i class="fas fa-compass"></i> Explore</h2>
<ul>
<li>Walk around to look at other areas where you are spending time in your code.
<ul>
<li>In many cases you find that there are very expensive areas of code that you cannot change (as you may not own it), but you can dictate whether or not it should be executed (or executed as frequently.</li>
</ul>
</li>
</ul>
<h3 id="i-classfas-fa-questioni-follow-ups"><i class="fas fa-question"></i> Follow Ups</h3>
<ul>
<li>Is there any method that stands out to you that might be unnecessarily called?</li>
</ul>
  <br/>
  <div class="card mb-3" style="width: 80%;">
      <div class="card-header text-white border-info bg-info">
          <i class="fas fa-arrow-alt-circle-right"></i>&nbsp;&nbsp;Up Next</div>
      <div class="card-body">
        <p class="card-text">
In the next section, we'll look at the Exceptions thrown by our application.
</p>
        <a href="https://jvmperf.net/docs/jmc/exceptions/">Exceptions</a></i>
      </div>
  </div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8e7ed7a50881f742b2d8880c7a90c384">3 - Exceptions</h1>
    <div class="lead">Find the exceptional cases in our application.</div>
	<p>In this section we&rsquo;ll dive into the Exceptions page and find out what information we can learn from it. Start by selecting the <strong>Exceptions</strong> page from the Outline.</p>
<p>This page offers the following sections:</p>
<ul>
<li>Overview: You can get Exceptions by Class and Count</li>
<li>Message: View the detail messages for all exceptions and errors.</li>
<li>Timeline/Event Log: View when a particular exception was thrown.</li>
<li>StackTrace: Identify where the exception was thrown from.</li>
</ul>
<p><img src="/jmc/exceptions_page.png" alt="">.</p>
<p>You can select an exception from the table to filter the information to that particular exception. You could also filter by a particular exception message.</p>
<p><img src="/jmc/exceptions_select_iae.png" alt=""></p>
<h2 id="i-classfas-fa-compassi-explore"><i class="fas fa-compass"></i> Explore</h2>
<p><code>NullPointerExceptions</code> are  a familiar exception you deal with in Java, and often times indicate a programming error. Other exception types often point to a common symptom.</p>
<h3 id="i-classfas-fa-questioni-follow-ups"><i class="fas fa-question"></i> Follow Ups</h3>
<ul>
<li>What are the exceptions that are getting generated the most?
<ul>
<li>What stack traces are the contributor?</li>
</ul>
</li>
<li>Can you find any areas in our code where we may have made an incorrect assumption regarding nullability?
<ul>
<li>Are there any other areas in our code where we might have made an incorrect assumption based on an exception&rsquo;s class?</li>
</ul>
</li>
<li>Are there any exceptions that might indicate a problem with our dependencies?</li>
</ul>
<p>¬†</p>
  <br/>
  <div class="card mb-3" style="width: 80%;">
      <div class="card-header text-white border-info bg-info">
          <i class="fas fa-arrow-alt-circle-right"></i>&nbsp;&nbsp;Up Next</div>
      <div class="card-body">
        <p class="card-text">
In the next section, we'll look at the Threads used by our application.
</p>
        <a href="https://jvmperf.net/docs/jmc/threads/">Threads</a></i>
      </div>
  </div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-140f7f618c6427a75628497db237e231">4 - Threads</h1>
    <div class="lead">Find the computation and latency events in your application.</div>
	<p>The <strong>Threads</strong> page provides a snaphost of all threads in our application, and we can use it to acquire information about computation and latency events.</p>
<p><img src="/jmc/threads_page.png" alt=""></p>
<h3 id="thread-chart">Thread Chart</h3>
<p>We can use the Thread Chart view to select a region of time and view the state of threads and the most common stack frames for that particular time slice:</p>
<p><img src="/jmc/thread_chart.png" alt=""></p>
<p>We can also edit the types of events shown by the chart. Right click on the chart, and select <strong>Edit Thread Activity Lanes</strong></p>
<p><img src="/jmc/edit_thread_lanes.png" alt=""></p>
<p>We can then narrow down on specific events.</p>
<p>For the purpose of this section filter on only the <strong>Sleep</strong> events. Then, select a period of time and look at what has caused our threads to go to sleep for that particular period:</p>
<p><img src="/jmc/filter_sleeping_threads.png" alt=""></p>
<p><img src="/jmc/sleeping_threads.png" alt=""></p>
<p>Once you&rsquo;re done with the filtered view, right click on the <strong>Thread</strong> page and Reset the page (to return to the default state).</p>
<p><img src="/jmc/reset_thread_page.png" alt=""></p>
<h3 id="by-thread">By Thread</h3>
<p>We can select an invididual thread from the <strong>Thread Table</strong> to further filter the data just for that thread. From this filtered view, we can inspect what the commonly executed methods are for a particular thread.</p>
<p><img src="/jmc/thread_selected.png" alt=""></p>
<p>We can then use the stacktrace view to correlate what piece of code executed the most.</p>
<p><img src="/jmc/thread_selected_stack_trace.png" alt=""></p>
<h2 id="i-classfas-fa-compassi-explore"><i class="fas fa-compass"></i> Explore</h2>
<p>There&rsquo;s a couple of threads specifically created by our application, these are the <code>wkshp-conf-loader</code> named threads. The <code>dw-*</code> named threads are threads created by DropWizard to handle specific requests (you might have noticed this based on the name containing a REST Resource). Explore the state of some of these threads while thinking about the follow up questions.</p>
<h3 id="i-classfas-fa-questioni-follow-ups"><i class="fas fa-question"></i> Follow Ups</h3>
<ul>
<li>Where are we spending most of our time sleeping? What is causing this?</li>
<li>Are there any unnecessary method invocations? Are any threads doing work that isn&rsquo;t visible?</li>
</ul>
<p>¬†</p>
  <br/>
  <div class="card mb-3" style="width: 80%;">
      <div class="card-header text-white border-info bg-info">
          <i class="fas fa-arrow-alt-circle-right"></i>&nbsp;&nbsp;Up Next</div>
      <div class="card-body">
        <p class="card-text">
In the next section, we'll look at the Memory state of our application.
</p>
        <a href="https://jvmperf.net/docs/jmc/memory/">Memory</a></i>
      </div>
  </div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7fa58ef1806796b7bc181181489c25b1">5 - Memory</h1>
    <div class="lead">Find the memory cost of events in our application.</div>
	<p>The memory page shows us the overall memory usage and garbage collection events for our recording.</p>
<p><img src="/jmc/memory_page.png" alt=""></p>
<p>The <strong>Class Table</strong> lets us view the total memory allocation dedicated to particular instances of that class. Selecting a particular class will allow us to view what code paths are responsible for creating those objects.</p>
<p><img src="/jmc/memory_class_selected.png" alt=""></p>
<p>We can also filter this view to a particular range in time, for example a range where we went from low to high heap usage:</p>
<p><img src="/jmc/memory_heap_rise.png" alt=""></p>
<p>We can then use this filtered view and drill down through the stack trace to find methods of interest:</p>
<p><img src="/jmc/memory_stack_trace_period.png" alt=""></p>
<h2 id="i-classfas-fa-compassi-explore"><i class="fas fa-compass"></i> Explore</h2>
<p>Narrow down through some periods of time where our heap rose quickly and then was collected. Look at the memory reclaimed after each collection.</p>
<h3 id="i-classfas-fa-questioni-follow-ups"><i class="fas fa-question"></i> Follow Ups</h3>
<ul>
<li>What are the most commonly allocated classes? Where do they come from?</li>
<li>Are there any classes we own that are also high on the allocation list?</li>
<li>Expand the memory usage chart and only chart the Used Heap, do you notice a pattern?
<ul>
<li>What do you think caused the flat line at the end of the chart?</li>
</ul>
</li>
</ul>
<p>¬†</p>
  <br/>
  <div class="card mb-3" style="width: 80%;">
      <div class="card-header text-white border-info bg-info">
          <i class="fas fa-arrow-alt-circle-right"></i>&nbsp;&nbsp;Up Next</div>
      <div class="card-body">
        <p class="card-text">
In the next section, we'll look at the I/O used by our application.
</p>
        <a href="https://jvmperf.net/docs/jmc/io_operations/">I/O Operations</a></i>
      </div>
  </div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-677c02967c93d2d024e0683d7ffa6d55">6 - I/O Operations</h1>
    <div class="lead">Find the interactions with external resources.</div>
	<p>The I/O pages can provide context of what external resources you are utilizing from you code base, and relate it to other latency events.</p>
<p>For the purpose of our workshop service, we are doing network I/O, and therefore will look at the <strong>Socket I/O</strong> page.</p>
<p>From this page, we can gain context of what host(s) we are calling, with what frequency, and the cost associated with those calls:</p>
<p><img src="/jmc/io_page.png" alt=""></p>
<p>We can then filter on a particular host and port and drill down into a particular piece of code responsible for that call:</p>
<p><img src="/jmc/io_page_9090.png" alt=""></p>
<h2 id="i-classfas-fa-compassi-explore"><i class="fas fa-compass"></i> Explore</h2>
<p>Filter through the total I/O time and explore a couple of events with high I/O.</p>
<h3 id="i-classfas-fa-questioni-follow-ups"><i class="fas fa-question"></i> Follow Ups</h3>
<ul>
<li>What remote services are we interacting with?</li>
<li>How long are we interacting with them and how many invocations?</li>
<li>How many times did we make calls and what threads were tied to those calls?</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e82c7a3c3eba03724a0e8df5a3ff19a3">7 - References</h1>
    <div class="lead">Collection of useful references used to build this guide.</div>
	<ul>
<li><a href="https://docs.oracle.com/javacomponents/doc/JDMUG/JDMUG.pdf">JDK Mission Control User Guide</a></li>
<li><a href="https://bell-sw.com/announcements/2020/07/22/Hunting-down-code-hotspots-with-JDK-Flight-Recorder/">Hunting down code hotspots with JFR</a></li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/cchesser/java-perf-workshop">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 - All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>













<script src="/js/main.min.f820bfc507c3ebefe17f8881ec4ee10013f3b89ad9555a50acf9bb1771e6823f.js" integrity="sha256-&#43;CC/xQfD6&#43;/hf4iB7E7hABPzuJrZVVpQrPm7F3Hmgj8=" crossorigin="anonymous"></script>



<script src='/js/prism.js'></script>



  </body>
</html>
